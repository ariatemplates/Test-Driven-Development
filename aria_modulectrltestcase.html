<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Module Controller Test Case - Test Driven Development</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <link rel="stylesheet" href="./css/font/font-awesome.min.css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="./css/font/font-awesome-ie7.min.css">
    <![endif]-->

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    <link rel="stylesheet" href="js/highlight.js/styles/github.css">
    <script src="js/highlight.js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left">
          <div id="bannerLeft">
            <h2>Test Driven Development</h2>
          </div>
        </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
          <li id="projectVersion">Version: 1.0.0</li>
          <li class="pull-right">
            <a href="https://github.com/ariatemplates/Test-Driven-Development" class="externalLink" title="This project on GitHub">This project on GitHub</a>
          </li>
          <li class="divider pull-right">|</li>
          <li class="pull-right">
            <a href="https://github.com/attester/attester" class="externalLink" title="attester">attester</a>
          </li>
          <li class="divider pull-right">|</li>
          <li class="pull-right">
            <a href="http://ariatemplates.com" class="externalLink" title="Aria Templates">Aria Templates</a>
          </li>
        </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">

              <li class="nav-header">Testing</li>
              <li>
                <a href="index.html" title="Introduction"><i class="none"></i>Introduction</a>
              </li>
              <li>
                <a href="terminology.html" title="Terminology"><i class="none"></i>Terminology</a>
              </li>

              <li class="nav-header">Aria Tester</li>
              <li>
                <a href="aria_testcase.html" title="Test Case"><i class="none"></i>Test Case</a>
              </li>
              <li class="active">
                <a href="aria_modulectrltestcase.html" title="Module Controller Test Case"><i class="icon-chevron-down"></i>Module Controller Test Case</a>
                <ul class="nav nav-list">
                  <li>
                    <a href="#assert">Assert</a>
                  </li>
                  <li>
                    <a href="#automatic">Automatic Creation</a>
                  </li>
                  <li>
                    <a href="#manual">Manual Creation</a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="aria_widgettestcase.html" title="Widget Test Case"><i class="none"></i>Widget Test Case</a>
              </li>
              <li>
                <a href="aria_templatetestcase.html" title="Template Test Case"><i class="none"></i>Template Test Case</a>
              </li>
              <li>
                <a href="aria_robottestcase.html" title="Robot Test Case"><i class="none"></i>Robot Test Case</a>
              </li>
            </ul>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >

          <h2>Module Controller Test Case</h2>

          <p><code><a href="http://ariatemplates.com/aria/guide/apps/apidocs/#aria.jsunit.ModuleCtrlTestCase" title="aria.jsunit.ModuleCtrlTestCase">ModuleCtrlTestCase</a></code> provides helper methods to instantiate and test module controllers. The class is designed to monitor all events and server connections made by a module.</p>

          <h2><a id="assert">Assert</a></h2>

          <p>On top of the assert methods that it inherits from <a href="aria_testcase.html">Test Case</a>, it provides the following:</p>

          <ul>
            <li><code>assertLogsClean</code> / <code>assertLogsNotClean</code> Asserts that there is no error in the logs, it is similar to <code>assertLogsEmpty</code> but it also checks for connection errors.
          </ul>

          The class has also the attribute <code>cxLogs</code>, an array of <code><a href="http://ariatemplates.com/aria/guide/apps/apidocs/#aria.jsunit.ConnectionSession">ConnectionSession</a></code>. These objects contain information on every request that is done through the module controller.

<pre><code>moduleControllerInstance.submitJsonRequest("search", {from : "here"}, callback);
this.cxLogs[0].ioRequest.url;  //  http://something.here/search
</code></pre>

          <h2><a id="automatic">Automatic Creation</a></h2>

          <p>Starting from Aria Templates <strong>1.3.7</strong> <code>ModuleCtrlTestCase</code> is able to automatically create and dispose the instance of Module Controller under test.</p>

          <p>By specifying <code>$controller</code> in the test's <code>$prototype</code> an instance of that class is generated before running the test. Inside the test methods you can access the two variables <code>$moduleCtrl</code> and <code>$moduleCtrlPrivate</code>.</p>

          <p>The public interface is also registered for asserting its logs, so there's no need to call <code>registerObject</code>.
          The test makes sure that objects are created and disposed correctly off-loading some work from the developer.</p>

          <pre><code>Aria.classDefinition({
    $classpath : "test.ModuleControllerTest",
    $extends : "aria.jsunit.ModuleCtrlTestCase",
    $dependencies : ["test.mock.RedirectToFile"],
    $prototype : {
        $controller : "myapp.SimpleController",

        setUp : function () {
            aria.core.IOFiltersMgr.addFilter("test.mock.RedirectToFile");
        },

        tearDown : function () {
            aria.core.IOFiltersMgr.removeFilter("test.mock.RedirectToFile");
        },

        testAsyncCallTheServer : function () {
            // Call an asynchronous method on the public interface
            this.$moduleCtrl.processCommand({
                fn : this.after,
                scope : this
            });
        },

        after : function () {
            this.assertEventFired("responseReceived");
            // This checks that there are no response error
            this.assertLogsClean();
            this.notifyTestEnd("testAsyncCallTheServer");
        }
    }
});</code></pre>

          <p><code>$controller</code> can be either a string or an object. If it's a string it's considered as a classpath, if it's an object it must match the bean <code><a href="http://ariatemplates.com/aria/guide/apps/apidocs/#aria.templates.CfgBeans:InitModuleCtrl" class="externallink">InitModuleController</a></code>. This allow to pass <code>initArgs</code> to the module's <code>init</code> method.</p>


          <pre><code>Aria.classDefinition({
    $classpath : "test.ModuleControllerTest",
    $extends : "aria.jsunit.ModuleCtrlTestCase",
    $prototype : {
        $controller : {
            classpath : "myapp.SimpleController",
            initArgs : {
                dataModel : {
                   value : "something"
                }
            }
        },

        testModel : function () {
            // Assuming that the module sets its data model to
            // what was passed as initArgs
            var data = this.$moduleCtrl.getData();
            this.assertJsonEquals(data, {
                value : "something"
            });
        }
    }
});</code></pre>


          <h3><a id="manual">Manual creation</a></h3>

          Before Aria Templates 1.3.7 the automatic mechanism to create a module controller instance is not available. In this case it's possible to manually create an instance with the following code:

          <pre><code>Aria.classDefinition({
    $classpath : "test.ModuleControllerTest",
    $extends : "aria.jsunit.ModuleCtrlTestCase",
    $dependencies : ["myapp.SimpleController", "aria.templates.ModuleCtrlFactory"],
    $prototype : {
        testAsyncModule : function () {
            aria.templates.ModuleCtrlFactory.createModuleCtrl({
                classpath : "myapp.SimpleController"
            }, {
                fn : afterModuleCreation,
                scope : this
            });
        },

        afterModuleCreation : function (result) {
            if (result.error) {
                this.fail("Unable to create the module controller: " + result.error);
            } else {
                var moduleCtrl = result.moduleCtrl;

                // Start testing something
                this.registerObject(moduleCtrl);
                moduleCtrl.callAMethod();
                this.assertEventFired("anEvent");

                // End of testing, do some cleaning
                this.unregisterObject(moduleCtrl);
                moduleCtrl.$dispose();
                this.notifyTestEnd("testAsyncModule");
            }
        }
    }
});</code></pre>
        </div>
      </div>
    </div>

    <hr/>

    <footer>
      <div class="container-fluid">
        <div class="row span12">Copyright &copy; 2013 <a href="http://www.amadeus.com/">Amadeus s.a.s</a>. All Rights Reserved.</div>
      </div>
    </footer>
  </body>
</html>